<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Hisab</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script>
        function togglePasscodeFields() {
            const isEncrypted = document.getElementById('isencrypted').checked;
            const passcodeFields = document.getElementById('passcodeFields');
            if (isEncrypted) {
                passcodeFields.classList.remove('hidden');
            } else {
                passcodeFields.classList.add('hidden');
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <%- include('partials/header', { 
        title: 'Create New Hisab',
        isLoggedIn: true,
        pageTitle: 'Create New Hisab'
    }) %>

    <div class="max-w-2xl mx-auto mb-8">
        <div class="card p-4 md:p-6 lg:p-8 rounded-lg shadow-md">
            <form action="/createNewHisab" method="POST" class="space-y-6">
                <div class="form-group">
                    <label for="hisabname" class="form-label text-custom-primary">Hisab Name</label>
                    <input 
                        type="text" 
                        id="hisabname" 
                        name="hisabname" 
                        required
                        placeholder="Enter a name for your hisab"
                        class="form-control bg-custom-white text-custom-primary border border-custom"
                    >
                </div>

                <div class="form-group">
                    <label for="hisabdescription" class="form-label text-custom-primary">Description</label>
                    <textarea 
                        id="hisabdescription" 
                        name="hisabdescription" 
                        rows="4" 
                        required
                        placeholder="Describe the purpose of this hisab"
                        class="form-control bg-custom-white text-custom-primary border border-custom"
                    ></textarea>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="flex items-center bg-custom-gray p-3 rounded-lg">
                        <input 
                            type="checkbox" 
                            id="isencrypted" 
                            name="isencrypted" 
                            onchange="togglePasscodeFields()"
                            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-custom rounded"
                        >
                        <label for="isencrypted" class="ml-2 block text-sm text-custom-primary">
                            <i class="fas fa-lock text-blue-600 mr-1"></i> Encrypt this Hisab
                        </label>
                    </div>

                    <div class="flex items-center bg-custom-gray p-3 rounded-lg">
                        <input 
                            type="checkbox" 
                            id="isshareable" 
                            name="isshareable"
                            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-custom rounded"
                        >
                        <label for="isshareable" class="ml-2 block text-sm text-custom-primary">
                            <i class="fas fa-share-alt text-blue-600 mr-1"></i> Make Shareable
                        </label>
                    </div>
                </div>

                <div id="passcodeFields" class="hidden space-y-4 bg-custom-gray p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-custom-primary mb-2">Security Settings</h3>
                    <div class="form-group">
                        <label for="passcode" class="form-label text-custom-primary">Passcode</label>
                        <input 
                            type="password" 
                            id="passcode" 
                            name="passcode"
                            placeholder="Enter 4-6 digit passcode"
                            class="form-control bg-custom-white text-custom-primary border border-custom"
                            minlength="4" 
                            maxlength="6"
                        >
                        <p class="mt-1 text-xs text-custom-secondary">Enter a 4-6 digit passcode to secure your hisab</p>
                    </div>
                    <div class="form-group">
                        <label for="confirmPasscode" class="form-label text-custom-primary">Confirm Passcode</label>
                        <input 
                            type="password" 
                            id="confirmPasscode" 
                            name="confirmPasscode"
                            placeholder="Confirm your passcode"
                            class="form-control bg-custom-white text-custom-primary border border-custom"
                            minlength="4" 
                            maxlength="6"
                        >
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row justify-end gap-3 mt-8">
                    <a href="/dashboard" class="btn-secondary px-6 py-2 rounded-md text-center">
                        Cancel
                    </a>
                    <button type="submit" class="btn-primary px-6 py-2 rounded-md">
                        Create Hisab
                    </button>
                </div>
            </form>
        </div>
    </div>

    <%- include('partials/footer', { 
        isLoggedIn: true,
        scripts: `
            function togglePasscodeFields() {
                const isEncrypted = document.getElementById('isencrypted').checked;
                const passcodeFields = document.getElementById('passcodeFields');
                
                if (isEncrypted) {
                    passcodeFields.classList.remove('hidden');
                } else {
                    passcodeFields.classList.add('hidden');
                }
            }
            
            // Validate passcodes match
            document.querySelector('form').addEventListener('submit', function(e) {
                const isEncrypted = document.getElementById('isencrypted').checked;
                
                if (isEncrypted) {
                    const passcode = document.getElementById('passcode').value;
                    const confirmPasscode = document.getElementById('confirmPasscode').value;
                    
                    if (passcode !== confirmPasscode) {
                        e.preventDefault();
                        alert('Passcodes do not match!');
                    }
                    
                    if (passcode.length < 4 || passcode.length > 6) {
                        e.preventDefault();
                        alert('Passcode must be 4-6 digits');
                    }
                }
            });
        `
    }) %>
</body>
</html>
